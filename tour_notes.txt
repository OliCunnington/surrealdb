<decimal>1000.00000000000001;
-- 1000dec

1000.00000000000001dec;
-- 1000.00000000000001dec

-- Works
<datetime>'1859-11-26';
-- Returns an error
<datetime>'EIGHTEEN FIFTY NINE, NOVEMBER TWENTY SIX';
-- Works
d'1859-11-26';
-- Query won't even run
d'EIGHTEEN FIFTY NINE, NOVEMBER TWENTY SIX';


UPDATE can be used to change fields (and add new ones... if SHEMALESS)

settings a field value to an id (SET whatever = place:surreal_library) creates a link
    can be list etc...


LET
-- Easy to read: this will be IDs of towns with the name Riverdale
LET $riverdale = SELECT VALUE id FROM town WHERE name = "Riverdale";

-- IDs of libraries with the name Riverdale in the address
LET $libraries = SELECT VALUE id FROM place WHERE "Riverdale" IN address;

-- Then update one with the other
UPDATE $riverdale SET libraries = $libraries;

-- Parameter is still around for reuse
-- If we had any cats we could link them to the libraries too
UPDATE cat SET libraries = $libraries;

SELECT *, libraries.name FROM town;

--  [
--    {
--      id: town:riverdale,
--      libraries: [
--        {
--          name: [
--            'Surreal Library'
--          ]
--        }
--      ],
--      name: 'Riverdale',
--      population: 75000
--    }
--  ]

SELECT 
    *, 
    libraries.{ name, floors }
FROM town;

--  [
--    {
--      id: town:riverdale,
--      libraries: [
--        {
--          floors: 8,
--          name: 'Surreal Library'
--        }
--      ],
--      name: 'Riverdale',
--      population: 75000
--    }
--  ]


-- use FETCH to display all the fields of a linked record
SELECT * FROM town FETCH libraries;

--  [
--    {
--      id: town:riverdale,
--      libraries: [
--        {
--          address: '2025 Statement Street, Riverdale',
--          floors: 8,
--          id: place:surreal_library,
--          name: 'Surreal Library',
--          place_type: 'library'
--        }
--      ],
--      name: 'Riverdale',
--      population: 75000
--    }
--  ]

 -- SHEMAFULL
 DEFINE TABLE schemafull_town SCHEMAFULL;
-- schemafull_town only has one defined field
DEFINE FIELD population ON schemafull_town TYPE number;

-- So the query succeeds, but 'name' data is ignored
CREATE schemafull_town SET name = "Riverdale", population = 75000;

-- SHEMALESS table can use define to restrict types for fields
-- Statements for the 'place' table
DEFINE FIELD address ON place TYPE string;
DEFINE FIELD name ON place TYPE string;

-- Statements for the 'town' table
DEFINE FIELD name ON town TYPE string;
DEFINE FIELD population ON town TYPE int;
DEFINE FIELD libraries ON town TYPE option<array<record<place>>>;

-- Records are always of type record<record_name>
-- array<...> able to hold more than one
-- option<...> allows for empty field / record creation without populated field

-- defines allowed values for a field
DEFINE FIELD place_type
    ON place
    TYPE "building" | "tower" | "store" | "school" | "park" | "library";

-- does the same thing
DEFINE FIELD place_type
    ON town
    TYPE string
    ASSERT $value IN ["building", "tower", "store", "school", "park", "library"];

-- dissalows negative population
DEFINE FIELD OVERWRITE population ON town TYPE int ASSERT $value >= 0;
-- use the OVERWRITE clause to rewrite the definition

--works fine, but returns NONE
LET $name = town:riverdale.naame;
--catches type mis-match
LET $name: string = town:riverdale.naame;
--  'Found NONE for param $name, but expected a string'


-- type restriction can be used in assignment
LET $type: "building" | "school" | "park" = place:surreal_library.place_type;
--  "Found 'library' for param $type, but expected a 'building' | 'school' | 'park'"


-- literal types can use combinations -> ENUMS and TAGGED UNIONS (?!)
LET $result: 
    "Good"
    | { error_type: "Bad gateway" | "Unauthorized", message: string } 
= { error_type: "Unauthorized", message: "Can't be accessed at this time" };

RETURN $result;

--  {
--    error_type: 'Unauthorized',
--    message: "Can't be accessed at this time"
--  }


INSERT INTO table_name [
    {
        JSON ACCEPTED HERE
    }
]

INSERT INTO person [
    {
        "name": "Sara Bellum",
        "age": 30        
    }
]
--  [
--    {
--      age: 30,
--      id: person:jbcyzmur1jalageanc1u,
--      name: 'Sara Bellum'
--    }
--  ]


--- FOR LOOPS

FOR $person IN [
  {
    age: 30,
    name: 'Sara Bellum'
  },
  {
    age: 25,
    name: 'Lydia Wyndham'
  },
  {
    age: 45,
    name: 'Samm Schwartz'
  }
] {
    CREATE person SET
        age = $person.age,
        name = $person.name
};

SELECT * FROM person;


--  [
--    {
--      age: 45,
--      id: person:cj8wc617o1ea2vs1yv4n,
--      name: 'Samm Schwartz'
--    },
--    {
--      age: 30,
--      id: person:e8z6pjqhuwzfalbku61n,
--      name: 'Sara Bellum'
--    },
--    {
--      age: 25,
--      id: person:faovorn8ntkqwfw01638,
--      name: 'Lydia Wyndham'
--    }
--  ]


-- GRAPH RELATIONS

UPDATE town:riverdale SET libraries = [place:surreal_library];
-- creates link, does not allow for meta data

-- table -> meta_data -> table_two
-- table <- meta_data <- table_two

-- Create writer->wrote->blog path
RELATE writer:one->wrote->blog:one;
--  [
--    {
--      id: wrote:7l04nq3umzufbemaldlz,
--      in: writer:one,
--      out: blog:one
--    }
--  ]

-- Create reader->likes->magazine path
RELATE reader:one->likes->magazine:one
    SET stars_out_of_ten = 7.5; -- and give it a field too if we want
--  [
--    {
--      id: likes:jd17lotl4nnyf06jl2ng,
--      in: reader:one,
--      out: magazine:one,
--      stars_out_of_ten: 7.5f
--    }
--  ]

--inside FOR loop 
FOR $person IN [
  {
    age: 30,
    name: 'Sara Bellum'
  },
  {
    age: 25,
    name: 'Lydia Wyndham'
  },
  {
    age: 45,
    name: 'Samm Schwartz'
  }
] {
    LET $created = CREATE ONLY person SET
        age = $person.age,
        name = $person.name;
    RELATE $created->works_at->place:surreal_library;
};

SELECT * FROM works_at;
--  [
--    {
--      id: works_at:3o8n3jmqx1uok41rjxq7,
--      in: person:g94fc1nqsraaatplddyh,
--      out: place:surreal_library
--    },
--    {
--      id: works_at:f3ghd88elmvs1jwfhpoc,
--      in: person:qpk3htqruhvd469pox0r,
--      out: place:surreal_library
--    },
--    {
--      id: works_at:j2yf2jdnmponak0v3q0q,
--      in: person:6kittp2n5lwpjzgu29jt,
--      out: place:surreal_library
--    }
--  ]

SELECT in.* FROM works_at;
--  [
--    {
--      in: {
--        age: 45,
--        id: person:f0z8cabmok8m9xn00lfu,
--        name: 'Samm Schwartz'
--      }
--    },
--    {
--      in: {
--        age: 30,
--        id: person:zfdzeawmuqh2mm498edj,
--        name: 'Sara Bellum'
--      }
--    },
--    {
--      in: {
--        age: 25,
--        id: person:ocp2l14l4nbgo60mnhgt,
--        name: 'Lydia Wyndham'
--      }
--    }
--  ]